<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>暗流：恐怖网络的诞生</title>
    <meta name="author" content="Alvaro Trigo Lopez"/>
    <meta name="description" content="fullPage very simple demo."/>
    <meta name="keywords" content="fullpage,jquery,demo,simple"/>
    <meta name="Resource-type" content="Document"/>




    <script src="jquery.js"></script>
    <script src="http://d3js.org/topojson.v0.min.js"></script>
    <script src="d3.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".high").click(function () {
                var org_name = $(this).attr('alt');
                highlight(org_name);
            });
            $(".rd").click(function () {
                d3.selectAll('circle,line').remove();
                redraw();
            })

        });

    </script>
    <style>

        .links line {
            stroke: #999;
            stroke-opacity: 0.6;
        }

        .nodes circle {
            stroke: #fff;
            stroke-width: 1.5px;
        }

        .high {
            border-radius: 10px;
            padding: 4px 6px 4px 6px;
            background-color: #4CAF50;
            color: white;
        }
    </style>



</head>
<body>

<div id="fullpage">
    <div class="section" id="section4">
        <div id='container' style="width:70%">
            <svg id="ss"></svg>
            <script>

                d3.select('svg#ss')
                    .attr('width', $('#container').width())
                    .attr('height', $(window).height());

                var svg_1 = d3.select("svg"),
                    width = +svg_1.attr("width"),
                    height = +svg_1.attr("height");

                var color = d3.scaleOrdinal(d3.schemeCategory20);


                var linkedByIndex = {};

                function redraw() {

                    d3.json("final2.json", function (error, graph) {
                        if (error) throw error;

                        var links = graph.links;
                        links.forEach(function (d) {
                            linkedByIndex[d.source + "," + d.target] = 1;
                        });
                        //console.log(linkedByIndex);
                        svg_1.append("rect")
                            .attr("width", width)
                            .attr("height", height)
                            .style("fill", "none")
                            .style("pointer-events", "all")
                            .call(d3.zoom()
                                .scaleExtent([1 / 2, 4])
                                .on("zoom", zoomed));

                        var g = svg_1.append("g");

                        var link = g
                            .attr("class", "links")
                            .selectAll("line")
                            .data(graph.links)
                            .enter().append("line");
                        var node = g
                            .attr("class", "nodes")
                            .selectAll("circle")
                            .data(graph.nodes)
                            .enter().append("circle");


                        restart();

                        function restart() {

                            var simulation = d3.forceSimulation()
                                .force("link", d3.forceLink().id(function (d) {
                                    return d.id;
                                }))
                                .force("charge", d3.forceManyBody().strength(-3))
                                .force("center", d3.forceCenter(width / 2, height / 2))
                                //.force("collide",d3.forceCollide( function(d){return d.r + 8 }).iterations(3) );;

                            link
                                .attr('stroke', '#999')
                                .attr("stroke-width", function (d) {
                                    return Math.sqrt(d.value) + 1;
                                })
                                .style('stroke-opacity', 0.8);

                            node
                                .attr("r", 5)
                                .attr("fill", function (d) {
                                    return color(d.group);
                                })
                                .on("mouseover", fade(.2))
                                .on("mouseout", fade(1))
                                //.on("click", function (d) {
                                //    alert(d.id + d.group);
                                //})

                                .on("click", function (d, i) {
                                    doubleclick(d, i);
                                })
                                .call(d3.drag()
                                    .on("start", dragstarted)
                                    .on("drag", dragged)
                                    .on("end", dragended));

                            node.append("title")
                                .text(function (d) {
                                    return d.id;
                                });


                            node.exit()
                                .remove();
                            link.exit()
                                .remove();

                            simulation
                                .nodes(graph.nodes)
                                .on("tick", ticked);

                            simulation.force("link")
                                .links(graph.links);


                            function dragstarted(d) {
                                if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                                d.fx = d.x;
                                d.fy = d.y;
                            }

                            function dragged(d) {
                                d.fx = d3.event.x;
                                d.fy = d3.event.y;
                            }

                            function dragended(d) {
                                if (!d3.event.active) simulation.alphaTarget(0);
                                d.fx = null;
                                d.fy = null;
                            }


                        }


                        function zoomed() {
                            g.attr("transform", d3.event.transform);
                        }


                        function ticked() {
                            var radius = 6;
                            link
                                .attr("x1", function (d) {
                                    return d.source.x;
                                })
                                .attr("y1", function (d) {
                                    return d.source.y;
                                })
                                .attr("x2", function (d) {
                                    return d.target.x;
                                })
                                .attr("y2", function (d) {
                                    return d.target.y;
                                });

                            node.attr("cx", function (d) {
                                return d.x = Math.max(radius, Math.min(width - radius, d.x));
                            })
                                .attr("cy", function (d) {
                                    return d.y = Math.max(radius, Math.min(height - radius, d.y));
                                });
                        }

                        function doubleclick(d, i) {
                            svg_1.selectAll('circle')
                                .filter(function (o) {
                                    return o.id === d.id;
                                })
                                .remove();
                            svg_1.selectAll('line')
                                .filter(function (o) {
                                    return o.source.index === d.index || o.target.index === d.index;
                                })
                                .remove();
                            restart();
                        }
                    });
                }

                redraw();


                function neighboring(a, b) {
                    return a + ',' + b in linkedByIndex || b + ',' + a in linkedByIndex;
                }

                function fade(opacity) {
                    return function (d, i) {
                        svg_1.selectAll("circle")
                            .style("fill-opacity", function (o) {
                                //console.log(neighboring(d, o));
                                //console.log(d.index+','+o.index);
                                return neighboring(d.id, o.id) ? 1 : opacity;
                            })
                            .style("stroke-opacity", function (o) {
                                //console.log(neighboring(d, o));
                                //console.log(d.index+','+o.index);
                                return neighboring(d.id, o.id) ? 1 : opacity;
                            });
                        d3.select(this).style('fill-opacity', 1);
                        d3.select(this).style('stroke-opacity', 1);
                        svg_1.selectAll("line").style("opacity", opacity);

                        svg_1.selectAll("line").filter(function (j) {
                            //console.log(j);
                            return j.source.index === d.index || j.target.index === d.index;
                        }).each(function (dLink, iLink) {
                            //unfade links and nodes connected to the current node
                            d3.select(this).style("opacity", 1);
                            //THE FOLLOWING CAUSES: Uncaught TypeError: Cannot call method 'setProperty' of undefined
                            //d3.select(dLink.source).style("opacity", 1);
                            //d3.select(iLink.target).style("opacity", 1);
                        });


                    };
                }


            </script>
        </div>
        <div id="txt"
             style="position: absolute;color:#565656;
             font-family: 'Microsoft YaHei';width: 30%;height: 100%;right: 0;top: 0;overflow-y: scroll;background-color: #fdfefc;display: block;">
            <script>
                function highlight(org_name) {
                    svg_1.selectAll('circle')
                        .filter(function (d) {
                            //console.log(d)
                            return d.id === org_name;
                        })
                        .each(function (d, i) {
                            console.log(d.id);
                            var now = d3.select(this);
                            var r = now.attr('r');
                            var f = now.attr('fill');

                            now.transition()
                                .duration(700)
                                .style('fill', 'yellow')
                                .style('r', 15)
                                .transition()
                                .duration(3000)
                                .style('fill', f)
                                .style('r', r);

                        })
                        .each(fade(0.2));

                };


            </script>
            <p style="font-size:xx-large;padding: 5px;line-height: 28px">
                <span class="rd">here</span>暗流：恐怖网络的诞生
            </p>
            <br>
            <p style="font-size: 14px;line-height: 28px">
                第三届数据新闻大赛参赛作品
                <br>
                团队 254 成员：刘智<br>
            </p>
            <p style="font-size: 16px">测试<span class="high" alt="Bahir Eldeen Brigade">点击</span>
            </p>
            <p style="font-size: 15px;padding: 16px 20px;line-height: 28px;margin: 0;text-align:justify;">
                世界从未有过彻底的和平。2001年发生在美国的<span class="high" alt="Al-Qaida">911恐怖袭击</span>举世震惊，犹在眼前；而近年来乌鲁木齐七五事件、昆明火车站暴力恐怖袭击等一系列事件，也打破了中国的平静；难民潮涌入欧洲，极端宗教分子攻击无辜人民，也让欧洲大陆疑云密布。
                <br><br>
                自1970年起，全世界已经发生了超过170000起恐怖袭击，造成了至少380000人死亡。其中，绝大部分的恐怖袭击都是由一个组织或极端分子发动，少部分恐怖袭击则由至少两个恐怖组织发动。
                <br><br>
                在1998年之前，平均每100起恐怖袭击中，只有不到1起是由恐怖组织联合发动的；1998年之后，恐怖组织则开始选择合作，每100起恐怖袭击中，最多有超过4起是由多个恐怖组织联合发动的。这说明恐怖活动进入了新形态，恐怖组织的合作将提高其袭击范围与强度，同时也加大了将其歼灭的难度。
                <br><br>
                为了挖掘恐怖组织的合作结构与合作模式，本文利用Global Terrorism Database
                (GTD)收集的全球恐怖袭击事件数据库，从中选取由两个及以上恐怖组织共同发动的恐怖袭击事件共1739起，作为基本的研究材料，并据此生成社会网络图(Social Network
                Graph)。图中的每一个圆点(称之为「节点」)代表一个恐怖组织；恐怖组织之间有合作，则两个点之间产生一条连线，连线越粗，说明两个恐怖组织的合作次数越多，其关系越紧密。
                <br><br>
                显而易见，从这幅网络图中，我们可以发现一些「群体」：一些节点之间的连接更为紧密，这些节点的集合就是一个群体（community）。这就说明，恐怖组织在相互合作的过程中，形成了合作群体。为了找出这些可能的群体，本文利用Fast-Greedy算法将这张网络图进行切割，找出来了148个群体。但是这些群体中，绝大部分都仅包含了个位数的恐怖组织，说明这些恐怖组织虽有合作，但合作次数极少，并不具有代表性。因此，将群体中恐怖组织个数少于5个的删除，最后剩下15个较大的恐怖组织合作群体。如本网页左侧所示，每种颜色代表了一个恐怖组织群体，同种颜色标注的恐怖组织之间的关系更密切。
                <br><br>
                在左侧的图中，需要重点关注两种类型的节点：一，一个群体中连接较多的节点；二，连接两个群体的节点。
                <br><br>
                前者意味着，该节点经常伙同其他恐怖组织发动恐怖袭击，极具煽动力与组织力，可以说是群体首领一般的存在。例如，活跃在阿富汗的<span class="high"
                                                                                  alt="Al-Qaida">塔利班组织</span>，与活跃在巴基斯坦与阿富汗边境地带的「巴基斯坦塔利班」（<span
                    class="high" alt="Tehrik-i-Taliban Pakistan (TTP)">Tehrik-i-Taliban Pakistan</span>）联系密切，而后者们又各自连接了许多其他恐怖组织。印度东北部的分裂势力<span
                    class="high" alt="United Liberation Front of Assam (ULFA)">United Liberation Front of Assam</span>，连接着多个活跃在印度的恐怖组织。如果反恐力量能够将这种恐怖组织攻破，那么以其为首的整个恐怖群体将会溃散，恐怖群体的内部凝聚力也就大大减弱，为反恐力量的逐个攻破带来希望。
                <br><br>
                而后者作为两个或多个群体的连接节点，则起到了「桥梁」的作用。如<span class="high" alt="Al-Qaida">基地组织</span>，不仅与其自身的群体联系密切，还连通了四个其他不同的恐怖群体。由于这类恐怖组织与多个群体都有联系，它们不仅可以交换情报，相互串通，从而规避反恐力量的打击，甚至恐怖群体还可以通过这些连接点恐怖组织相互勾结，形成更大的恐怖群体。因此，这类恐怖组织也应当成为打击的重点，从而将恐怖群体与恐怖群体割裂开来，避免它们串通情报。
                <br><br>
                除此之外，还有一种节点，同时具备了两种性质，既是群体内的首领之一，又是不同群体间的连接点。例如，近年来制造了多起血腥暴力事件的<span class="high"
                                                                                     alt="Islamic State of Iraq and the Levant (ISIL)">伊斯兰国</span>，不仅在群体内与其他恐怖组织连接紧密，多次共同发动恐怖袭击，还连通了其他四个恐怖群体。这说明，伊斯兰国对群体内的其他恐怖组织具有极强的号召力，同时在外还具备多种情报源，而这也是其近年来生存、扩张并难以被铲除的重要原因。
                <br><br>

            </p>
            <p style="font-size: 15px;">
                鸣谢
                <br><br>
                本网站的布局与颜色样式借鉴了财新·数字说栏目作品<a href="http://datanews.caixin.com/mobile/yimin/" target="_blank">《移民去远方》</a>，在此表示感谢。
                <br><br>
                作者信息
                <br><br>
                刘智
                <br><br>
                台湾交通大学管理科学系硕士
                <br><br>
                现于上海交通大学管理科学与工程系交换
                <br><br>
            </p>
        </div>
    </div>

</div>

</body>
</html>